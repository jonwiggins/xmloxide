#!/bin/sh
# Pre-commit hook for xmloxide.
# Runs formatting, clippy, tests, and doc build before allowing commits.
#
# Install with: ./scripts/install-hooks.sh

echo "Running cargo fmt --check..."
if ! cargo fmt --all -- --check; then
    echo ""
    echo "ERROR: Code is not formatted. Run 'cargo fmt --all' to fix."
    exit 1
fi
echo "Formatting check passed."

echo ""
echo "Running cargo clippy..."
if ! cargo clippy --all-targets --all-features -- -D warnings; then
    echo ""
    echo "ERROR: Clippy found warnings. Fix them and try again."
    exit 1
fi
echo "Clippy check passed."

echo ""
echo "Running cargo test..."
if ! cargo test --all-features --quiet; then
    echo ""
    echo "ERROR: Tests failed. Fix them and try again."
    exit 1
fi
echo "All tests passed."

echo ""
echo "Running cargo doc..."
if ! RUSTDOCFLAGS="-D warnings" cargo doc --all-features --no-deps --quiet; then
    echo ""
    echo "ERROR: Documentation build has warnings. Fix them and try again."
    exit 1
fi
echo "Documentation check passed."

echo ""
echo "All pre-commit checks passed."
